### Wireshark 使用教程

------

[TOC]

##### 01：概念

- 网络抓包分析软件（开源），简称**小鲨鱼**，功能十分强大。可以截取各种网络封包，显示网络封包的详细信息。
- 网站：https://www.wireshark.org/

##### 02：抓包原理

1. 单机环境
   - 电脑直连网络，Wireshark直接抓取本机网卡的网络流量；
2. 连接交换机
   - 应用比较多的网络环境，Wireshark通过端口镜像、ARP欺骗等方式获取局域网中的网络流量。
     - 端口镜像：利用交换机的接口，将局域网的网络流量转发到指定电脑的网卡上。
     - ARP欺骗：交换机根据MAC地址转发数据，伪装其他终端的MAC地址，从而获取局域网的网络流量。

##### 03：抓包demo

1. 菜单栏中->capture -> options
2. 选择input -> 选择需要抓取的网卡
3. 点击Start 开始抓包
4. 点击stop capture packets 停止抓包
5.  在过滤栏**设置过滤条件**进行数据包列表过滤，ip.addr == 183.232.231.172 and icmp
6. 数据包列表区中不同的协议使用了不同的颜色区分。协议颜色标识定位在菜单栏 视图 --> 着色规则。

![wireshark](/Users/likang/Code/Git/Middleware/30：Crawler/photos/wireshark.png)

##### 04：过滤器设置

- 抓包过滤器
  - 抓包过滤器的菜单栏路径为 capture -> Capture Filters
  - 添加新的过滤条件：ip host 183.232.231.172表示只捕获主机IP为183.232.231.172的数据包;
- 显示过滤器
  - ip.addr == 183.232.231.172

##### 05：过滤器规则

###### 抓包过滤器语法和实例

​	抓包过滤器类型Type（host、net、port）、方向Dir（src、dst）、协议Proto（ether、ip、tcp、udp、http、icmp、ftp等）、逻辑运算符（&&与、|| 或、！非）

- 协议过滤：直接在抓包过滤框中直接输入协议名即可
  - tcp，只显示TCP协议的数据包列表
  - http，只查看HTTP协议的数据包列表
  - icmp，只显示ICMP协议的数据包列表
- IP过滤
  - host 192.168.1.104
  - src host 192.168.1.104
  - dst host 192.168.1.104
- 端口过滤
  - port 80
  - src port 80
  - dst port 80
- 逻辑运算符&&与、|| 或、！非
  - src host 192.168.1.104 &&dst port 80 抓取主机地址为192.168.1.80、目的端口为80的数据包

###### 显示过滤器语法和实例

- 比较操作符
  - == 等于、！= 不等于、> 大于、< 小于、>= 大于等于、<=小于等于
- 协议过滤：直接在Filter框中直接输入协议名即可。注意：协议名称需要输入小写
  - tcp，只显示TCP协议的数据包列表
- ip过滤
  - ip.src ==112.53.42.42 显示源地址为112.53.42.42的数据包列表
  - ip.dst==112.53.42.42, 显示目标地址为112.53.42.42的数据包列表
  - ip.addr == 112.53.42.42 显示源IP地址或目标IP地址为112.53.42.42的数据包列表
- 端口过滤
  - tcp.port ==80,  显示源主机或者目的主机端口为80的数据包列表。
  - tcp.srcport == 80,  只显示TCP协议的源主机端口为80的数据包列表。
  - tcp.dstport == 80，只显示TCP协议的目的主机端口为80的数据包列表。
- http模式过滤
  - http.request.method=="GET",  只显示HTTP GET方法的。
- 逻辑运算符为 and/or/not
  - ip.addr == 192.168.0.104 and icmp
- 按照数据包内容过滤
  - 选中数据 -> 作为过滤器应用