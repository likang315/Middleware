### 聚合

------

[TOC]

##### 01：概述

- 聚合框架用于根据搜索查询提供聚合数据。聚合可以看作**在一组文档上构建分析信息的工作单元**;
- 执行上下文定义此文档集是什么;
- 通常根据目的和输出，将它们分为四大类：
  1. 存储桶聚合
     - 构建存储桶（bucket）的聚合系列，其中每个存储桶都与键和文档相关联。**当执行聚合时，将对上下文中的每个文档评估所有bucket条件。当条件匹配时，文档将被视为“属于”相关bucket**。在聚合过程结束时，我们将得到一个存储桶列表——每个存储桶都有一组属于它的文档；
  2. 度量值聚合
     - 在**一组文档上跟踪和计算度量值**（metrics）（一个数字）的聚合。
  3. 矩阵聚合
     - **对多个字段进行操作并根据从请求的文档字段中提取的值生成矩阵结果的聚合系列**。此聚合系列尚不支持脚本功能；
  4. 管道聚合【子聚合】
     - 聚合其他聚合的输出及其相关度量值的聚合。
     - 存储桶聚合可以具有子聚合（度量值聚合或存储桶聚合），在其父聚合生成的存储桶下计算子聚合；

##### 02：度量值聚合

- 