;try {
/* module-key = 'confluence.web.resources:page-ordering-tree', location = '/includes/js/ddtree/tree.js' */
(function(b){b.ui=b.ui||{};b.fn.extend({tree:function(t){if(!this.is(".ui-tree"))return new b.ui.tree(this,t)}});var u=function(b){b.preventDefault()};b.ui.tree=function(t,n){function v(a,d){for(var a=(a+"").toLowerCase(),d=(d+"").toLowerCase(),e=/(\d+|\D+)/g,i=a.match(e),e=d.match(e),c=Math.max(i.length,e.length),b=0;b<c;b++){if(b==i.length)return-1;if(b==e.length)return 1;var s=parseInt(i[b],10),f=parseInt(e[b],10);if(s==i[b]&&f==e[b]&&s!=f)return(s-f)/Math.abs(s-f);if((s!=i[b]||f!=e[b])&&i[b]!=
e[b])return i[b]<e[b]?-1:1}return 0}function w(a){this[0]=a[0];this.$=a;this.text=a.find("span").text();this.href=a.find("a").attr("href");this.linkClass=a.find("a").attr("class");this.nodeClass=a.attr("class");this.open=function(a){if(c.visibleNodes.length)return c.visibleNodes[this[0].num].open&&c.visibleNodes[this[0].num].open(a);AJS.log("tried to open empty node")};this.insertChild=function(a){a.$&&(a=a[0]);c.visibleNodes[this[0].num].append(a)};this.reorder=function(){c.visibleNodes[this[0].num].order(v)};
this.close=function(){c.visibleNodes[this[0].num].close()};this.getAttribute=function(a){return this[0][a]};this.setAttribute=function(a,d){this[0][a]=d};this.highlight=function(){this.$.addClass("highlighted")};this.unhighlight=function(){this.$.removeClass("highlighted")};this.makeDraggable=function(){this.setAttribute("undraggable",!1);this.$.removeClass("undraggable")};this.makeUndraggable=function(){this.setAttribute("undraggable",!0);this.$.addClass("undraggable")};this.makeClickable=function(a){this.setAttribute("unclickable",
!1);this.$.removeClass("unclickable");var d=this[0].getElementsByTagName("a"),a=a?b(d[0]):b(d);a.unbind("click",u);a.click(c.events.click)};this.makeUnclickable=function(a){this.setAttribute("unclickable",!0);this.$.addClass("unclickable");var d=this[0].getElementsByTagName("a"),a=a?b(d[0]):b(d);a.click(u);a.unbind("click",c.events.click)};this.setText=function(a){this.text=a;this[0].text=a;this.$.find("span").text(a)};this.getParent=function(){if(this.$.parent(":not(.ui-tree)").length){var a=this.$.parent().parent();
if(a.length)return new w(b(a[0]))}return null};this.append=function(a){var d=this.$.find("ul");if(!d.length){if(this[0].toBeLoaded){var e=this;this.open(function(){e.append(a)});return!1}this.$.append("<ul></ul>");d=this.$.find("ul")}var b=q(a);d.append(b);p.call(b);"undefined"==typeof this[0].closed&&(this.$.addClass("closed"),this[0].closed=!0,d.hide());j()};this.below=function(a){a=q(a);this.$.after(a);p.call(a);j()};this.above=function(a){a=q(a);this.$.before(a);p.call(a);j()};this.remove=function(){this.$.remove();
j()};this.reload=function(){this[0].getElementsByTagName("ul").length&&(this[0].removeChild(this[0].getElementsByTagName("ul")[0]),this.$.removeClass("opened").addClass("closed"),this[0].closed=!0,c.visibleNodes[this[0].num].open())};this.order=function(a){var d=b("ul",this.$),e=this[0];e.ordered=!0;if(d.length){var c=[];e.oldorder=[];b("li",this.$).each(function(){c.push(this);e.oldorder.push(this)});c.sort(function(d,e){return a(b(d).find("span").html(),b(e).find("span").html())});e.order=c;for(var f=
0,k=c.length;f<k;f++)d.append(c[f])}j()};this.orderUndo=function(){this[0].ordered=!1;var a=b("ul",this.$);if(this[0].oldorder&&a.length)for(var d=0,e=this[0].oldorder.length;d<e;d++)a.append(this[0].oldorder[d]);this[0].oldorder=null;j()};this.setOrdered=function(a){this[0].ordered=a;b("a.abc:first",this).css("display",a?"none":"block");b("a.rollback:first",this).css("display","none")};if(f.options.parameters&&f.options.parameters.length)for(var d=0,e=f.options.parameters.length;d<e;d++)a[0][f.options.parameters[d]]&&
(this[f.options.parameters[d]]=a[0][f.options.parameters[d]])}function x(a){return!("li"==a.tagName.toLowerCase()&&1>b("li:not(.tree-helper)",a).length)}function l(a){this.$li=b(a);this.height=this.$li.height()}function r(a){a=c.points[a];return"undefined"!=typeof a?{visibleNode:c.visibleNodes[a.num],where:a.where,top:a.top}:{visibleNode:new l(o),where:"append",top:c.dim.top}}function y(){var a=0,d=0;c.points=[];for(var e=0,b=c.visibleNodes.length;e<b;e++){var g=c.visibleNodes[e].$li.offset(),h=Math.round(g.top);
c.visibleNodes[e].top=h;c.visibleNodes[e].left=Math.round(g.left);if(a)for(var g=(h-a)/4,f=a;f<h;f++){var j=f-a<g?"above":f-a<3*g?"append":"below";c.points[f]={num:d,where:j,top:a}}if(e==b-1){g=c.visibleNodes[e].height/4;for(f=h;f<h+c.visibleNodes[e].height;f++)j=f-h<g?"above":f-h<3*g?"append":"below",c.points[f]={num:e,where:j,top:h}}a=h;d=e}}function j(){c.visibleNodes=[];for(var a=b("li:visible",o),d=0,e=a.length;d<e;d++)b(a[d]).hasClass("tree-helper")||(a[d].num=c.visibleNodes.length,c.visibleNodes.push(new l(a[d])));
y()}function p(){var a=b(this);f.options.undraggable?a.mousedown(u):(a.draggable(A()),a[0].undraggable=a.hasClass("undraggable"));var d=b(this.getElementsByTagName("a")[0]);f.options.unclickable?(a.addClass("unclickable"),d.click(u)):d.click(c.events.click);f.options.oninsert&&f.options.oninsert.call(new w(a),d)}function q(a){var d=document.createElement("li");d.className=a.nodeClass;if(f.options.parameters&&f.options.parameters.length)for(var e=0,c=f.options.parameters.length;e<c;e++)a[f.options.parameters[e]]&&
(d[f.options.parameters[e]]=a[f.options.parameters[e]]);f.options.nodeId&&(d.id="node-"+a[f.options.nodeId]);var e=document.createElement("a"),c=document.createElement("span"),g=document.createElement("i");g.className="decorator";e.href=a.href;c.appendChild(document.createTextNode(a.text));e.appendChild(c);e.appendChild(g);e.className=a.linkClass;a=document.createElement("div");b(a).addClass("click-zone");b(a).click(B);b(d).mouseover(C).mouseout(D);d.appendChild(a);d.appendChild(e);e=document.createElement("div");
e.className="button-panel";d.appendChild(e);c=document.createElement("a");c.className="abc";c.title="Sort Alphabetically";e.appendChild(c);g=document.createElement("a");g.className="rollback";g.title="Undo Sorting";e.appendChild(g);b(c).click(E);b(g).click(F);if(f.options.isAdministrator){var h=document.createElement("a");h.className="preview-node";h.title="Preview";e.appendChild(h);b(h).click(G);h=document.createElement("a");h.className="remove-node";h.title="Delete";e.appendChild(h);b(h).click(H)}b(c).css("display",
"none");b(g).css("display","none");e=b(d);e.hasClass("opened")?(e.removeClass("opened").addClass("closed"),d.closed=!0):e.hasClass("closed")?d.toBeLoaded=!0:b(a).css("display","none");return d}var k=t,f=this,z=!1,I=arguments;if(!/^[ou]l$/i.test(k[0].tagName)){z=!0;if(!n.url)return!1;k.html("<ul></ul>");k=b("ul",k)}var o=k[0];k.addClass("ui-tree");var c={list:k,visibleNodes:[],dim:k.offset(),points:[],win:b(window),timer:null,prev:0,events:{grab:function(){},click:function(){},drag:function(){},drop:function(){},
append:function(){},insertabove:function(){},insertbelow:function(){},load:function(){},nodeover:function(){},nodeout:function(){},onready:function(){},order:function(){},orderUndo:function(){},remove:function(){},preview:function(){}}};this.options=n;this.expandPath=function(a,d){d=d||function(){};if(a.length){var c=1,b,g,h=function(){if(c<a.length){for(var g in a[c])if(b=f.findNodeBy(g,a[c][g]))break;c++;b.open(h)}else d()};for(g in a[0]){b=this.findNodeBy(g,a[0][g]);break}b&&b.open(h)}else d()};
this.reload=function(a){z&&k.remove();for(var d in a)this.options[d]=a[d];return new I.callee(t,this.options)};this.append=function(a){a=q(a);k.append(a);p.call(a);j()};this.unhighlight=function(){k.find("li.highlighted").each(function(){b(this).removeClass("highlighted")})};this.findNodeBy=function(a,d){for(var c=[],i=o.getElementsByTagName("li"),g=0,h=i.length;g<h;g++)i[g][a]==d&&c.push(new w(b(i[g])));return 0==c.length?null:1==c.length?c[0]:c};for(var m in c.events)"function"==typeof n[m]&&(c.events[m]=
n[m]);l.prototype.append=function(a){if(this.$li[0]==a)return!1;if(this.$li[0].toBeLoaded){var d=this;this.load(function(){d.append(a)});return!1}if("li"==this.$li[0].tagName.toLowerCase()){var e=b("ul:first",this.$li),i=a.parentNode.parentNode;b(".rollback:first",i).css("display","none");e.length?(e.append(a),this.$li[0].ordered&&this.order(v)):(e=document.createElement("ul"),e.appendChild(a),this.$li[0].appendChild(e),this.$li.addClass("opened"),b(".click-zone:first",this.$li).css("display","inline"),
b(".rollback:first",this.$li).css("display","none"));x(i)||c.visibleNodes[i.num].notaFolderAnymore();setTimeout(j,0);c.events.append.call({source:a,target:this.$li[0]})}};l.prototype.below=function(a){var d=a.parentNode.parentNode;this.$li.after(a);b(".rollback:first",d).css("display","none");x(d)?!b(a.parentNode).hasClass("ui-tree")&&!a.parentNode.parentNode.undraggable&&(a.parentNode.parentNode.ordered=!1,b(".abc:first",a.parentNode.parentNode).css("display","block"),b(".rollback:first",a.parentNode.parentNode).css("display",
"none")):c.visibleNodes[d.num].notaFolderAnymore();setTimeout(j,0);c.events.insertbelow.call({source:a,target:this.$li[0]})};l.prototype.above=function(a){var d=a.parentNode.parentNode;this.$li.before(a);b(".rollback:first",d).css("display","none");x(d)?!b(a.parentNode).hasClass("ui-tree")&&!a.parentNode.parentNode.undraggable&&(a.parentNode.parentNode.ordered=!1,b(".abc:first",a.parentNode.parentNode).css("display","block"),b(".rollback:first",a.parentNode.parentNode).css("display","none")):c.visibleNodes[d.num].notaFolderAnymore();
setTimeout(j,0);c.events.insertabove.call({source:a,target:this.$li[0]})};l.prototype.order=function(a){var c=this.$li[0];c.ordered=!0;var e=b("ul:first",this.$li);if(e.length){var i=[];c.oldorder=[];b("li",this.$li).each(function(){this.parentNode.parentNode==c&&(i.push(this),c.oldorder.push(this))});i.sort(function(c,d){var e=b("span",c).text().replace(/^\s+|\s+$/g,""),g=b("span",d).text().replace(/^\s+|\s+$/g,"");return a(e,g)});c.order=i;for(var g=0,h=i.length;g<h;g++)e.append(i[g])}j()};l.prototype.orderUndo=
function(){var a=this.$li[0];a.ordered=!1;var c=b("ul:first",this.$li);if(a.oldorder&&c.length&&c[0].parentNode==a)for(var e=0,i=a.oldorder.length;e<i;e++)c.append(a.oldorder[e]);a.oldorder=null;a.oldor=null;j()};l.prototype.open=function(a){a=a||function(){};if(this.$li.hasClass("closed")){var c=b("ul:has(li)",this.$li);return c.length?(c.show(),this.closed=!1,this.$li.removeClass("closed").addClass("opened"),j(),a(!0),!0):this.load(a)}a(!1);return!1};l.prototype.close=function(a){var a=a||function(){},
d=this.$li.contents().filter("ul:has(li)");d.length&&(d.hide(),this.closed=!0,this.$li.removeClass("opened").addClass("closed"),c.visibleNodes.splice(this.$li[0].num+1,d[0].getElementsByTagName("li").length),j(),a())};l.prototype.load=function(a){var d=f.options.url;if(!d)return!1;a=a||function(){};this.$li[0].toBeLoaded=!1;this.$li[0].closed=!0;var e={};if(n.parameters&&n.parameters.length)for(var i=0,g=n.parameters.length;i<g;i++)e[n.parameters[i]]=this.$li[0][n.parameters[i]]||"";var h=this;this.$li[0].getElementsByTagName("span");
var j=b(".button-panel",this.$li[0]);h.loading=!0;j.spin({left:"10px"});b.ajax({url:d,type:"GET",dataType:"json",data:e,success:function(d){var e=b("ul",h.$li);e.length||(e=document.createElement("ul"),h.$li[0].appendChild(e),e=b(e));h.ordered="number"!=typeof d[0].position;for(var g=0,i=d.length;g<i;g++){var f=q(d[g]);e[0].appendChild(f);p.call(f)}e.hide();h.open(a);c.events.load();j.spinStop();h.$li[0].ordered=h.ordered;b(".abc:first",h.$li[0]).css("display",h.ordered||f.undraggable?"none":"block");
b(".rollback:first",h.$li[0]).css("display","none")}});return!0};l.prototype.notaFolderAnymore=function(){this.$li.removeClass("closed").removeClass("opened");b(".click-zone:first",this.$li).hide();b(".abc:first",this.$li).css("display","none");b(".rollback:first",this.$li).css("display","none");var a=this.$li[0].getElementsByTagName("ul");this.closed=!1;a.length&&this.$li[0].removeChild(a[0])};this.updateVisibleNodes=j;var A=function(){var a={distance:3,helper:"clone",opacity:0.7,cursorAt:{top:c.H/
2,left:30},stop:function(d){clearInterval(c.timer);clearTimeout(c.opentimer);c.opentimer=null;var b=r(c.prev);b.visibleNode.$li.removeClass("over").removeClass("above").removeClass("append").removeClass("below");b.visibleNode.$li.next().removeClass("over").removeClass("above").removeClass("append").removeClass("below");c.win.unbind("keypress",c.escape);delete c.escape;if(a.revert)return a.revert=!1;for(var b=r(d.pageY||d.originalEvent.pageY),d=b.visibleNode.$li[0],i=!0;d!=o;){if(d==this){i=!1;break}d=
d.parentNode}if(i=i&&!("above"==b.where&&b.visibleNode.$li.prev()[0]==this)&&!("append"==b.where&&b.visibleNode.$li[0]==this.parentNode.parentNode))b.visibleNode[b.where](this),c.events.drop.call({position:b.where,source:this,target:b.visibleNode.$li[0]})},start:function(d,e){var i=this;e.helper.append("<strong></strong>").addClass("tree-helper").find(".button-panel").remove();c.events.grab.call(i);this.undraggable&&(e.helper.addClass("no"),a.revert=!0);c.escape=function(d){if(d.keyCode==27){d=r(c.prev);
d.visibleNode.$li.removeClass("over").removeClass("above").removeClass("append").removeClass("below");d.visibleNode.$li.next().removeClass("over").removeClass("above").removeClass("append").removeClass("below");var f=e.helper.clone();e.helper.before(f);f.animate({left:Math.round(b(i).offset().left)+"px",top:Math.round(b(i).offset().top)+"px",opacity:0},"slow","swing",function(){f.remove()});e.helper.css("display","none");a.revert=true}};c.win.keypress(c.escape)},drag:function(b,e){b.pageY=b.pageY||
b.originalEvent.pageY;b.pageX=b.pageX||b.originalEvent.pageX;var f=r(c.prev);f.visibleNode.$li.removeClass("above").removeClass("append").removeClass("below");f.visibleNode.$li.next().removeClass("above").removeClass("append").removeClass("below");if(!a.revert||c.out){c.prev=b.pageY;var g=r(c.prev);if(g.visibleNode.$li[0]==o)a.revert=!0,c.out=!0;else{c.out&&(c.out=!1,a.revert=!1);g.visibleNode!=f.visibleNode&&(c.events.nodeout.call(f.visibleNode.$li),c.opentimer&&(clearTimeout(c.opentimer),c.opentimer=
!1));c.events.nodeover.call({element:g.visibleNode.$li,position:g.where});var f=g.where,h=g.visibleNode.$li.next();"below"==f&&h.length&&!h.hasClass("tree-helper")?h.addClass("above"):r(c.prev).visibleNode.$li.addClass(f);if("append"==g.where&&(g.visibleNode.closed||g.visibleNode.$li[0].toBeLoaded)&&!c.opentimer)f=c,h=setTimeout(function(){g.visibleNode.$li.removeClass("append");g.visibleNode.open(function(){c.opentimer=false})},500),f.opentimer=h;var j=arguments.callee;30>c.win.height()-b.pageY+
c.win.scrollTop()?(clearInterval(c.timer),c.timer=setInterval(function(){window.scrollBy(0,4);e.helper.css("top",parseInt(e.helper.css("top"))+4+"px");j({pageY:b.pageY+4},e)},c.win.height()-b.pageY+c.win.scrollTop())):0<c.win.scrollTop()&&30>b.pageY-c.win.scrollTop()?(clearInterval(c.timer),c.timer=setInterval(function(){window.scrollBy(0,-4);j({pageY:b.pageY-4},e);e.helper.css("top",parseInt(e.helper.css("top"))-4+"px")},b.pageY-c.win.scrollTop())):c.timer&&clearInterval(c.timer);c.events.drag.call({element:this,
left:b.pageX,top:b.pageY})}}}};return a};b.ui.tree.callNumber=0;var B=function(){if(!c.visibleNodes[this.parentNode.num].loading)return b(this.parentNode).hasClass("closed")?c.visibleNodes[this.parentNode.num].open():c.visibleNodes[this.parentNode.num].close(),!1},C=function(a){b(a.target).hasClass("tree-helper")||b(".button-panel:first",this).addClass("hover");return!1},D=function(a){b(a.target).hasClass("tree-helper")||b(".button-panel:first",this).removeClass("hover");return!1},E=function(){var a=
c.visibleNodes[this.parentNode.parentNode.num];a.order(v);c.events.order.call({source:a.$li[0]});b(this).hide();b("a.rollback",this.parentNode).show();return!1},F=function(){var a=c.visibleNodes[this.parentNode.parentNode.num];a.orderUndo();c.events.orderUndo.call({source:a.$li[0],orderedChildren:b("ul:first",a.$li[0]).children()});b(this).hide();b("a.abc",this.parentNode).show();return!1},G=function(a){a.preventDefault();c.events.preview.call({source:preview,node:c.visibleNodes[this.parentNode.parentNode.num].$li[0]})},
H=function(a){a.preventDefault();c.events.remove.call({source:c.visibleNodes[this.parentNode.parentNode.num].$li[0]})};m=k.contents().filter("li");if(0<m.length)c.H=m.height(),m.each(p),j(),c.events.onready.call(this);else{m=f.options.initUrl||f.options.url;if(!m)return!1;b(k).spin({left:"0%"});var J=++b.ui.tree.callNumber;b.getJSON(m,function(a){for(var d=0,e=a.length;d<e;d++){var f=q(a[d]);o.appendChild(f);0==d&&(c.H=b(f).height());p.call(f)}j();b(k).spinStop();J==b.ui.tree.callNumber&&(c.events.onready.call(this),
b.ui.tree.callNumber=0)})}c.offset=o.offsetTop;setInterval(function(){o.offsetTop!=c.offset&&(y(),c.offset=o.offsetTop)},10);return this}})(jQuery);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
