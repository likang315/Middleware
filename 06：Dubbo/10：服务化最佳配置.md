### 服务最佳配置

------

[TOC]

##### 01：分包

- 建议**将服务接口、服务模型、服务异常等均放在 API 包中**，因为服务模型和异常也是 API 的一部分，这样做也符合分包原则：重用发布等价原则(REP)，共同重用原则(CRP)。
- provider 用于实现API包接口，暴露服务；
- 如果需要，也可以考虑在 **API 包中放置一份 Spring 的引用配置**，这样使用方只需在 Spring 加载过程中引用此配置即可。配置建议放在模块的包目录下，以免冲突，如：`com/alibaba/china/xxx/dubbo-reference.xml`。

##### 02：粒度

- **服务接口尽可能大粒度，每个服务方法应代表一个功能**，而不是某功能的一个步骤，**否则将面临分布式事务问题**，Dubbo 暂未提供分布式事务支持。
- 服务接口建议**以业务场景为单位划分，**并对相近业务做抽象，防止接口数量爆炸。

##### 03：版本

- 每个接口都应定义版本号，为后续不兼容升级提供可能；
- 如： `<dubbo:service interface="com.xxx.XxxService" version="1.0" />`。
- 建议**使用两位版本号**，因为第三位版本号通常表示兼容升级，只有不兼容时才需要变更服务版本，**当不兼容时，先升级一半提供者为新版本，再将消费者全部升为新版本，然后将剩下的一半提供者升为新版本**。

##### 04：兼容性

- **服务接口增加方法，或服务模型增加字段，可向后兼容**，删除方法或删除字段，将不兼容，**枚举类型新增字段也不兼容**，需通过变更版本号升级。

##### 05：序列化

- **服务参数及返回值建议使用 POJO 对象**，即通过 `setter`, `getter` 方法表示属性的对象。
- 服务参数及返回值都必须**是传值调用，而不能是传引用调用**，消费方和提供方的参数或返回值引用并不是同一个，只是值相同，Dubbo 不支持引用远程对象。

##### 06：异常

- 建议使用**异常汇报错误**，而不是返回错误码，异常信息能携带更多信息，并且语义更友好。
- 查询方法**不建议抛出 checked 异常，否则调用方在查询时将过多的 `try...catch`，**并且不能进行有效处理。

