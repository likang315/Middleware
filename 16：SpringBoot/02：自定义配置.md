### SpringBoot 自定义配置

------

[TOC]

##### 01：覆盖 SpringBoot 自动配置【全变】

- 继承相应的配置类，重写该方法；

###### 原理

- 都使用了Spring 4.0的条件化配置，可以在运行时判断这个配置是该被运用，还是该被忽略。
- @Conditional

##### 02：通过属性文件外置配置【微调】

###### 自动配置微调

- 不过，为了微调一些小变动，比如改端口号和日志级别，便放弃自动配置，显然是不合适的。
- 事实上，Spring Boot自动配置的Bean提供了**300多个用于微调的属性**。

###### 禁止打印Banner

- 启动SpringBoot 时，有一个ascii-art Banner。如果想要禁用，可以将spring.main.show-banner属性设置为false。
- 实现方式：【优先级高的会覆盖优先级低的】
  1. 命令行参数
     - $ java -jar atlantis-0.0.1.jar --spring.main.show-banner=false 
  2.  java:comp/env里的JNDI属性
     - spring.main.show-banner=false 
  3. JVM 系统属性
  4. 环境变量（下换线）
     - export spring_main_show_banner=false

###### 配置嵌入式服务器

- 从命令行运行Spring Boot应用程序时，应用程序会**启动一个嵌入式的服务器（默认是Tomcat），监听8080端口**。大部分情况下这样挺好，但**同时运行多个应用程序可能会有问题**。要是所有应用程序都试着让Tomcat服务器监听同一个端口，在启动第二个应用程序时就会有冲突。
- 配置：java -jar readinglist-0.0.1-SNAPSHOT.jar --server.port=8000

###### 应用程序 Bean 的配置外配

- 通过 @ConfigurationProperties(prefix="xxx") 注解，把前缀为 xxx 的属性注入；

###### 使用 Profile 进行配置

- @Profile 是一种条件化配置，基于运行时激活的Profile，会使用或者忽略不同的Bean或配置类。

- 示例

  - ```java
    @Profile("prod")
    @Configuration
    @EnableWebSecurity
    public class SecurityConfig extends WebSecurityConfigurerAdapter {
     // ...
    } 
    ```

  - 这里用的@Profile注解要求**运行时激活prod Profile**，这样才能应用该配置。如果 prod Profile没有激活，就会忽略该配置，而此时**缺少其他用于覆盖的安全配置**，于是应用自动配置的安全配置。

##### 03：定制应用程序错误页面

- Spring Boot 默认提供“白标”（whitelabel）错误页，这是自动配置的一部分。虽然这比 Stacktrace页面要好一点，但还是不够美观有效，你应该为应用程序创建一个自定义的错误页。

- Spring Boot自动配置的默认**错误处理器先会查找名为error的视图，如果找不到就用默认的白标错误视图**，因此，最简单的方法就是创建一个自定义视图，让解析出的视图名为 error。将其放在 **src/main/resources/templates** 目录下；

- Spring Boot 会为错误视图提供如下错误属性。 

  1. timestamp：错误发生的时间。 
  2. status：HTTP状态码。
  3. error：错误原因。
  4. exception：异常的类名。
  5. message：异常消息（如果这个错误是由异常引起的）。
  6. errors：BindingResult异常里的各种错误（如果这个错误是由异常引起的）。
  7. trace：异常跟踪信息（如果这个错误是由异常引起的）。
  8. path：错误发生时请求的URL路径。

- ```html
  <html>
      <head>
          <title>ERROR ！！!</title>
          <link rel="stylesheet" th:href="@{/style.css}"></link>
      </head>
  <html>
      <div class="errorPage">
          <span class="error">ERROR ！！!</span><br/>
      <p>There seems to be a problem with the page you requested
          (<span th:text="${path}"></span>).</p>
      <p th:text="${'Details: ' + message}"></p>
           <p th:text="${'Details: ' + trace}"></p>
      </div>
  </html>
  </html> 
  ```

  