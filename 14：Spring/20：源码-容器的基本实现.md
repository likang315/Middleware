### 容器的基本实现

------

[TOC]

##### 01：容器的基础（XmlBeanFactory）

###### 加载Bean 的示例

```java
@SuppressWarnings("deprecation")
public class BeanFactoryTest {
    @Test
    public void testSimpleLoad(){
        BeanFactory bf = new XmlBeanFactory(new ClassPathResource("beanFactoryTest.xml"));
        MyTestBean bean=(MyTestBean) bf.getBean("myTestBean");
        assertEquals("testStr",bean.getTestStr());
    }
}
```

###### 配置文件的封装

- Spring对其内部使用到的资源 实现了自己的抽象结构：**Resource 接口**封装底层资源，便可以低所有资源文件进行统一处理。
- 对**不同来源的资源文件都有相应的Resource实现**：文件（FileSystemResource）、Classpath资源 （ClassPathResource）、URL资源 （UrlResource）、InputStream资源 （InputStreamResource）、Byte数组 （ByteArrayResource）等。
- 当通过Resource相关类完成了对配置文件进行封装后，配置文件的读取工作就全权交给 **XmlBeanDefinitionReader** 来处理。
- XmlBeanFactory —> AbstractAutowireCapableBeanFactory
  - 如果被依赖的Bean，实现了BeanNameAware 接口，就不会被初始化，其本身通过其他的方式进行注入；

###### 加载Bean

- XmlBeanFactory(Resource)  —> XmlBeanDefinitionReader —> XmlBeanDefinitionReader.doLoadBeanDefinitions —> XmlBeanDefinitionReader.registerBeanDefinitions

###### 获取 XML 的验证方式

- 验证模式保证了XML文件的正确性，比较常用的两种验证模式：DTD和XSD；

###### 获取Document

- EntityResolver：可以提供一 个如何寻找DTD声明的方法，即由程序来实现寻找 DTD声明的过程。
  - 分别的是识别DTD 和 XSD 的连接
    - publicId
    - systemId


###### 解析及注册 BeanDefinitions

- DefaultBeanDefinitionDocumentReader
- 获取Document  的 root 节点
- 核心功能：org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions（Element root）；
  - 解析 PROFILE_ATTRIBUTE 属性，区分环境；
  - 通过xml 的 NameSpace 区分是否默认的，还是自定义xml，则使用不同的方式解析；

##### 02：默认标签的解析

- 入口：org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseDefaultElement
- 分别对4 种不同标签（import、alias、bean和beans）做了不同的处理。

###### bean标签的解析及注册

- 







