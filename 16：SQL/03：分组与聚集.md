### 分组与聚集

------

[TOC]

##### 01：分组概念

- 





##### 02：聚集函数

- 

##### 03：产生分组

- 

##### 04：分组过滤条件

- 









##### 06：GROUP BY：分组

- 将结果集按照指定的**字段值相同的记录分为一组**，常和分组函数联用；

- 如果在以某字段为根据进行了分组之后，select 那个字段得到的不是这个字段的信息，而是这个字段的分组信息，如果不与聚合函数联合使用，只显示该组第一条记录；

- 使用Select查询的列，在使用分组的语句中**要不包含在group by 字段中，要不包含在聚合函数中**。不然查询会报错。

- ```sql
  select stu.name, avg(s.math) as math, avg(s.chinese) as chinese
  from score s INNER JOIN student stu
  ON stu.id = s.student_id
  group by stu.name;
  ```

  - score 表中可能会有多条一个学生的成绩，求平均
    - 先找到联表中符合限定条件的信息；
    - 以group by 后的字段作为分组key；
    - 进行聚合计算，最终显示也是key，字段名；

- **多列分组**：按照多列（字段A+字段B）合并后的值进行分组；

- **HAVING 条件表达式**：用来限制分组后的显示，符合条件表达式的结果将被显示；

  - HAVING   COUNT(sex) >= 1;

- **WITH ROLLUP**：将会加上一条记录，这一条记录是上面所有记录的总和。

###### 聚合函数

- MAX（），MIN（）：求指定字段的最大值和最小值
- AVG，SUM：求平均值和总和
- COUNT( )：对给定字段的记录进行统计 
  - COUNT（*）：统计这个表有多少记录，有时候返回long，有时候返回 BigInteger，配合进行
  - SELECT price, **count(*) AS number** FROM tablename GROUP BY price；

